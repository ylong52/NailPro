<!--<h2>欢迎来到我们的网站！</h2>-->
<!--<p>这是一个使用Handlebars模板引擎的Express应用程序。</p>-->
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=320px,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>个人名片</title>
    <script>
        // 根据屏幕宽度动态设置根元素的字体大小
        // (function () {
        //     var scale = 1 / window.devicePixelRatio;
        //     document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=device-width, initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
        //     var html = document.documentElement;
        //     var width = html.getBoundingClientRect().width;
        //     html.style.fontSize = width / 10 + 'px'; // 假设设计稿宽度为750px，这里将宽度分成10份，1rem等于75px
        // })();
    </script>
</head>
<body>
<div id="app">
    <el-container>
        <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="120px" class="demo-ruleForm">

            <h1 style="font-family: ui-monospace;margin-left: 2rem">个人名片
                <span style='font-size:50px;'>&#128070;</span> </h1>

            <el-form-item label="姓名" prop="realname">
                <el-input v-model="ruleForm.realname"></el-input>
            </el-form-item>
            <el-form-item label="手机号" prop="mobile_phone">
                <el-input v-model="ruleForm.mobile_phone"></el-input>
            </el-form-item>
            <el-form-item label="微信" prop="weixing">
                <el-input v-model="ruleForm.weixing"></el-input>
            </el-form-item>
            <el-form-item label="说二句">
                <el-input type="textarea" v-model="ruleForm.desc"></el-input>
            </el-form-item>
            <div style="margin-left: -6rem;">
                <el-form-item  >
                    <el-divider content-position="left">美图秀秀(最少一张图)</el-divider>
                    <el-upload action="/user/uploads" list-type="picture-card"
                               :file-list="fileList" :auto-upload="true" :on-change="handleChange" :on-success="handSuccess">
                        <i slot="default" class="el-icon-plus"></i>
                        <div slot="file" slot-scope="{file}">
                            <img class="el-upload-list__item-thumbnail" :src="file.url" alt="" />
                            <span class="el-upload-list__item-actions">
                                <span class="el-upload-list__item-preview" @click="handlePictureCardPreview(file)"> <i class="el-icon-zoom-in" style="font-size: 3rem;"></i> </span>

                                <span v-if="!disabled" class="el-upload-list__item-delete" @click="handleRemove(file)"> <i class="el-icon-delete" style="font-size: 3rem;"></i> </span>
                            </span>
                        </div>
                    </el-upload>

                    <el-dialog :visible.sync="dialogVisible">
                        <img width="100%" :src="dialogImageUrl" alt="" />
                    </el-dialog>
                </el-form-item>
            </div>
            <el-form-item>
                <el-button type="primary" :disabled="btn_disabled" @click="submitForm('ruleForm')">
                    保存
                </el-button>
                <el-button @click="resetForm('ruleForm')">
                    清空
                </el-button>
            </el-form-item>

        </el-form>
    </el-container>
</div>
<script src="/vue2.6.11.js"></script>
<script src="/element-ui.js"></script>
<script src="/jquery-1.9.1.min.js"></script>
<style>
    html {
        font-family: "Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif;
    }
    .el-container {
        margin-top: 40px;
        margin-left: 10px;

        justify-content: flex-start;
    }
    h3 {
        font-family: cursive;
        padding-left: 4rem;

    }
    .el-form-item__label{
        font-weight: bolder;
        width: 80px !important;
    }
    .demo-ruleForm {
        display: flex;
        border-left: 1px solid #a6a9ad;
        flex-direction: column;
        align-content: flex-start;
        padding-top: 10px;
        padding-bottom: 20px;
    }
</style>
<script>
    new Vue({
        el: '#app',
        data: function () {
            return {
                dialogVisible: false,
                dialogImageUrl: '',
                disabled:false,
                fileList:[],
                btn_disabled:false,
                ruleForm: {
                    realname: '',
                    mobile_phone: '',
                    weixing: '',
                    desc: '',
                },
                rules: {
                    realname: [
                        {required: true, message: '请输入姓名', trigger: 'blur'},
                        {min: 2, max: 10, message: '长度在 2 到 10 个字', trigger: 'blur'}
                    ],
                    mobile_phone: [
                        {required: true, message: '手机号必输', trigger: 'change'}
                    ],
                    desc: [
                        {required: true, message: '请填写备注', trigger: 'blur'}
                    ]
                }
            }
        },
        methods: {
            submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        if (this.fileList.length ==0) {
                            this.$notify.info({
                                title: '提示',
                                message: '请上传最少一张图'
                            });
                            return false;
                        }
                        this.ruleForm.fileList = this.fileList
                        this.btn_disabled = true;
                        let _self = this;
                        setTimeout(function (){
                            _self.btn_disabled = false;
                        },3000)
                        this.$notify.info({
                            title: '消息',
                            message: '正在提交中...'
                        });
                        $.ajax({
                            type: "POST",
                            url: "/user/reguser",
                            contentType: "application/json",
                            data: JSON.stringify(this.ruleForm),
                            success: function (data) {
                                if (data.code == 0 && data.data?.uuid) {
                                    console.log(data);
                                    window.location.href = "/userinfo/" + data.data.uuid;
                                    return false;
                                }

                            }
                        });
                    } else {
                        console.log('error submit!!');
                        this.$notify({
                            title: '警告',
                            message: '提交失败！',
                            type: 'warning'
                        });
                        return false;
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            },
            handleChange(file, fileList) {

            },
            handleRemove(file) {
                if (this.fileList.length ==0) return ;
                this.fileList = this.fileList.filter((item) => item.uid !== file.uid);
            } ,
            handlePictureCardPreview(file,fileList) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            },
            handSuccess(file,fileList) {
                this.fileList.push(fileList);
            }

        }
    })
</script>
</body>
</html>