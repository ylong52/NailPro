<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=320px,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <title>Fingerella指尖魔法</title>

</head>
<body>
<div id="app">
    <div  v-show="editVisible">
        <el-container>
            <h1 style="font-size: 1.0rem;margin-left: 0rem;">
			<span style='font-size:1.4rem;'>&#128070;</span>
			欢迎来到fingerella指尖魔法</h1>

            <el-form :model="ruleForm" :rules="rules" ref="ruleForm"  class="demo-ruleForm"  >
                <el-form-item  prop="webtitle">
                    <lable for="webtitle">网站标题</lable>
                    <el-input id="webtitle" v-model="ruleForm.webtitle"  placeholder="您可以设置有趣个人网站"></el-input>
                    </el-form-item >

                <el-form-item  prop="realname">
                    <lable for="realname"  >姓名<em>*</em></lable>
                    <el-input id="realname" v-model="ruleForm.realname" placeholder="姓名" ></el-input>
                    <div v-if="errors.realname">{{ errors.realname }}</div>
                </el-form-item >

                <el-form-item  prop="mobile_phone">
                    <lable for="mobile_phone" >手机号<em>*</em></lable>
                    <el-input id="mobile_phone" v-model="ruleForm.mobile_phone" placeholder="手机号必输" ></el-input>
                    <div v-if="errors.mobile_phone">{{ errors.mobile_phone }}</div>
                </el-form-item >

                <el-form-item  prop="weixing">
                    <lable for="weixing">微信</lable>
                    <el-input id="weixing" v-model="ruleForm.weixing" placeholder="微信"></el-input>
                </el-form-item >

                <el-form-item  prop="xiaohongshu">
                    <lable for="xiaohongshu">小红书(链接)</lable>
                    <el-input id="xiaohongshu" type="textarea" v-model="ruleForm.xiaohongshu" placeholder="填635757a30xxx"></el-input>
                    <div class="tips">例：https://www.xiaohongshu.com/user/profile/635757a30xxx</div>
                    <div v-if="errors.xiaohongshu">{{ errors.xiaohongshu }}</div>
                </el-form-item >

                <div style="margin-left: 0rem;margin-top:1rem;">
                        <lable content-position="left">个人照片(最少一张图)</lable>
                        <el-upload action="/user/uploads" list-type="picture-card"
                                   :file-list="fileList" :auto-upload="true" :on-change="handleChange"
                                   :on-success="handSuccess">
                            <i slot="default" class="el-icon-plus"></i>
                            <div slot="file" slot-scope="{file}">
                                <img class="el-upload-list__item-thumbnail" :src="file.url" alt=""/>
                                <span class="el-upload-list__item-actions">
                                <span class="el-upload-list__item-preview" @click="handlePictureCardPreview(file)"> <i
                                        class="el-icon-zoom-in" style="font-size: 3rem;"></i> </span>

                                <span v-if="!disabled" class="el-upload-list__item-delete" @click="handleRemove(file)"> <i
                                        class="el-icon-delete" style="font-size: 3rem;"></i> </span>
                            </span>
                            </div>
                        </el-upload>
                        <el-dialog :visible.sync="dialogVisible">   
                            <img width="100%" :src="dialogImageUrl" alt=""/>
                        </el-dialog>    
                </div>

                <el-form-item prop="desc">
                    <lable for="desc">其他想说的</lable>
                    <el-input id="desc" type="textarea" v-model="ruleForm.desc"></el-input>
               </el-form-item>
    
                <el-form-item style="margin-top:0rem;">
                    <el-button  type="primary"  @click="submitForm('ruleForm')">
                        保存及预览
                    </el-button>
                    <el-button @click="resetForm('ruleForm')">
                        清空
                    </el-button>
                </el-form-item>

            </el-form>
        </el-container>
    </div>

    <div v-show="priviewVisible">
        <h2 class="private_title">预览效果页</h2>
        <div style="padding:0 1rem;">
            <h1 style="font-family: ui-monospace;"><span style='font-size:70px;'>&#128075;</span>
                <{userInfo.website}>
            </h1>
            <el-carousel :interval="4000"   height="20rem">
                <el-carousel-item v-for="image in userInfo.images" :key="image">
                    <el-image :src="image" fit="contain" ></el-image>
                </el-carousel-item>
            </el-carousel>
        </div>

        <div class="infoblock" style="padding:1rem 2rem;">
            <p><span>姓名:</span> <{userInfo.realname}></p>
            <p><span>手机号:</span> <{userInfo.mobile_phone}></p>
            <p><span>微信号:</span> <{userInfo.weixing}></p>
            <p><span>我的留言:</span> <{userInfo.desc}></p>
        </div>

        <div style="display: flex;margin:0 2rem;margin-bottom: 2rem; ">
            <div style="margin-top: 1rem;">
                <el-empty description="二维码" style="height: 2rem"></el-empty>
            </div>
            <div>
                <el-button type="danger"  disabled="" round class="share" style="margin-left: 1rem;width: 6rem;" >小红书</el-button>

                <el-button round class="share btn" type="info"   disabled  style="background-color:#000000;margin-left: 1rem;margin-top: 1rem; width: 6rem;" >分享</el-button>
            </div>
        </div>
        <div style="margin-top: 6rem;    text-align: center">
            <el-button v-if="ruleForm.mobile_phone" type="primary"  style="width: 40%;"  @click="gotourl()">
                     发布
            </el-button>
            <el-button v-if="ruleForm.mobile_phone" type="plain"  style="width: 40%;"  @click="switchPriview(true)">
                返回
            </el-button>
        </div>
    </div>



</div>
<script src="/vue2.6.11.js"></script>
<script src="/element-ui.js"></script>
<script src="/jquery-1.9.1.min.js"></script>
<style>
    html {
        font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    }

    .el-container {
         
        float: none;
        padding: 1rem;
		flex-direction: column
    }
	
	lable {
		font-weight: bolder;		
		font-size:0.8rem;
	}

    .el-form-item {
        margin-bottom: 0px;
    }

    .el-form-item__content {
        margin-top: 1rem;
    }

    h3 {
        font-family: cursive;
        padding-left: 4rem;

    }

    .el-form-item__label {
        font-weight: bolder;
		display: block;
		float: none;
    }

    .demo-ruleForm {
        display: flex;
      
        flex-direction: column;
        align-content: flex-start;
        padding-bottom: 20px;
    }
	
	.el-input__inner {
    height: 3rem;
    line-height: 1rem;
}
    
    .private_title{
        background-color: yellow;
    }

    .infoblock p>span {
        font-weight: 550;
    }

    .tips {
        font-size: 0.5rem;
    }
</style>
<script>
    new Vue({
        el: '#app',
        delimiters: ['<{', '}>'],  //分隔符
        data: function () {
            return {
                dialogVisible: false,
                dialogImageUrl: '',
                disabled: false,
                fileList: [],
                btn_disabled: false,
                userInfo:[],
                uuid:'',
                editVisible:true,
                priviewVisible:false,
                ruleForm: {
                    webtitle: '',
                    realname: '',
                    mobile_phone: '',
                    weixing: '',
                    xiaohongshu: '',
                    desc: '',
                },
                notification:'',
                rules: {
                    webtitle:[                       
                        { pattern: /^[0-9a-zA-Z-_]+$/, message: '字符串只能包含数字和英文字母', trigger: ['blur', 'change'] }
                    ],
                    realname: [
                        {required: true, message: '请输入姓名', trigger: ['blur', 'change', 'submit']},
                        {min: 1, max: 20, message: '长度在1 到20 个字', trigger: ['blur', 'change', 'submit']},
                        {
                            pattern: /^[0-9a-zA-Z_-\u4e00-\u9fa5]+$/,
                            message: '字符串只能包含中文、数字和英文字母',
                            trigger: ['blur', 'change']
                        }
                    ],
                    mobile_phone: [
                        {required: true, message: '手机号必输', trigger: 'change'},
                        {
                            pattern: /^1[3-9]\d{9}$/, // 这是一个匹配11位手机号的正则表达式
                            message: '请输入正确的11位手机号',
                            trigger: 'change'
                        }
                    ],
                    xiaohongshu: [
                        { required: false, message: '请输入字符串', trigger: 'blur' },
                        { pattern: /^[0-9a-zA-Z]+$/, message: '字符串只能包含数字和英文字母', trigger: ['blur', 'change'] }
                    ]
                },
                errors:{}
            }
        },
        methods: {
            submitForm(formName) {
                 

                this.$refs[formName].validate((valid) => {

                    if (valid) {
                        if (this.fileList.length == 0) {
                            this.$notify.info({
                                title: '提示',
                                message: '请上传最少一张图'
                            });
                            return false;
                        }
                        this.ruleForm.fileList = this.fileList
                        this.btn_disabled = true;
                        let _self = this;
                        setTimeout(function () {
                            _self.btn_disabled = false;
                        }, 3000)
                        _self.notification = this.$notify.info({
                            title: '消息',
                            message: '正在提交中...',
                            duration: 0 
                        });
                        $.ajax({
                            type: "POST",
                            url: "/user/reguser",
                            contentType: "application/json",
                            data: JSON.stringify(this.ruleForm),
                            success: function (data) {
                                if (data.code == 0 && data.data?.uuid) {
                                    _self.notification.close();
                                    _self.uuid = data.data.uuid;
                                    _self.getuserbymobile();

                                    return false;
                                }

                            }
                        });
                    } else {
                        console.log('error submit!!');
                        this.$notify({
                            title: '警告',
                            message: '提交失败！',
                            type: 'warning'
                        });
                        return false;
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            },
            handleChange(file, fileList) {

            },
            handleRemove(file) {
                if (this.fileList.length == 0) return;
                this.fileList = this.fileList.filter((item) => item.uid !== file.uid);
            },
            handlePictureCardPreview(file, fileList) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            },
            handSuccess(file, fileList) {
                this.fileList.push(fileList);
            },
            getuserbymobile() {
                let _self = this;
                let postData ={}
                postData.mobile_phone = _self.ruleForm.mobile_phone
                $.ajax({
                    type: "POST",
                    url: "/user/getuserbymobile",
                    contentType: "application/json",
                    data:JSON.stringify(postData),
                    success: function (data) {
                        _self.userInfo = data.data.userinfo;
                        _self.userInfo.images = _self.userInfo.images.split(";")
                        if (data.data.userinfo.webtitle) {
                            _self.userInfo.website = data.data.userinfo.webtitle
                        } else {
                            _self.userInfo.website = data.data.userinfo.realname
                        }
                        _self.editVisible = false;
                        _self.priviewVisible = ! this.editVisible
                    }
                });
            },
            gotourl() {
                window.location.href = "/userinfo/" + this.uuid;
                return false;
            },
            switchPriview(_bool) {
                 this.editVisible = _bool;
                 this.priviewVisible = ! this.editVisible
            }
        },

        mounted() {
            // this.getuserbymobile();
        }
    })
</script>
</body>
</html>