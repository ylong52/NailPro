<!--<h2>欢迎来到我们的网站！</h2>-->
<!--<p>这是一个使用Handlebars模板引擎的Express应用程序。</p>-->
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=320px,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <title>Fingerella指尖魔法</title>

</head>
<body>
<div id="app">
    <div  v-show="editVisible">
        <el-container>
            <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="120px" class="demo-ruleForm">

                <h1 style="font-family: ui-monospace;margin-left: 2rem"><span style='font-size:50px;'>&#128070;</span>欢迎来到fingerella的指尖魔法
                    </h1>

                <el-form-item label="网站标题" prop="webtitle">
                    <el-input v-model="ruleForm.webtitle"  placeholder="您可以设置有趣个人网站"></el-input>
                </el-form-item>

                <el-form-item label="姓名" prop="realname">
                    <el-input v-model="ruleForm.realname"></el-input>
                </el-form-item>
                <el-form-item label="手机号" prop="mobile_phone">
                    <el-input v-model="ruleForm.mobile_phone"></el-input>
                </el-form-item>
                <el-form-item label="微信" prop="weixing">
                    <el-input v-model="ruleForm.weixing"></el-input>
                </el-form-item>

                <el-form-item label="小红书(链接)">
                    <el-input type="textarea" v-model="ruleForm.xiaohongshu"></el-input>
                </el-form-item>


                <div style="margin-left: -6rem;">
                    <el-form-item>
                        <el-divider content-position="left">个人照片(最少一张图)</el-divider>
                        <el-upload action="/user/uploads" list-type="picture-card"
                                   :file-list="fileList" :auto-upload="true" :on-change="handleChange"
                                   :on-success="handSuccess">
                            <i slot="default" class="el-icon-plus"></i>
                            <div slot="file" slot-scope="{file}">
                                <img class="el-upload-list__item-thumbnail" :src="file.url" alt=""/>
                                <span class="el-upload-list__item-actions">
                                <span class="el-upload-list__item-preview" @click="handlePictureCardPreview(file)"> <i
                                        class="el-icon-zoom-in" style="font-size: 3rem;"></i> </span>

                                <span v-if="!disabled" class="el-upload-list__item-delete" @click="handleRemove(file)"> <i
                                        class="el-icon-delete" style="font-size: 3rem;"></i> </span>
                            </span>
                            </div>
                        </el-upload>

                        <el-dialog :visible.sync="dialogVisible">
                            <img width="100%" :src="dialogImageUrl" alt=""/>
                        </el-dialog>
                    </el-form-item>
                </div>

                <el-form-item label="其他想说的">
                    <el-input type="textarea" v-model="ruleForm.desc"></el-input>
                </el-form-item>

                <el-form-item>
                    <el-button  type="primary"  @click="submitForm('ruleForm')">
                        保存及预览
                    </el-button>
                    <el-button @click="resetForm('ruleForm')">
                        清空
                    </el-button>
                </el-form-item>

            </el-form>
        </el-container>
    </div>

    <div v-show="priviewVisible">
        <div style="padding:0 1rem;">
            <h1 style="font-family: ui-monospace;"><span style='font-size:70px;'>&#128075;</span>
                <{userInfo.website}>
            </h1>
            <el-carousel :interval="4000"   height="20rem">
                <el-carousel-item v-for="image in userInfo.images" :key="image">
                    <el-image :src="image" fit="contain" ></el-image>
                </el-carousel-item>
            </el-carousel>
        </div>

        <div class="infoblock" style="padding:1rem 2rem;">
            <p><span>手机号:</span> <{userInfo.mobile_phone}></p>
            <p><span>微信号:</span> <{userInfo.weixing}></p>
            <p><span>我的留言:</span> <{userInfo.desc}></p>
        </div>

        <div style="display: flex;margin:0 2rem;margin-bottom: 2rem; ">
            <div style="margin-top: 1rem;">
                <el-empty description="二维码" style="height: 2rem"></el-empty>
            </div>
            <div>
                <el-button type="danger"  disabled="" round class="share" style="margin-left: 1rem;width: 6rem;" >小红书</el-button>

                <el-button round class="share btn" type="info"   disabled  style="background-color:#000000;margin-left: 1rem;margin-top: 1rem; width: 6rem;" >分享</el-button>
            </div>
        </div>
        <div style="margin-top: 6rem;    text-align: center">
            <el-button v-if="ruleForm.mobile_phone" type="primary"  style="width: 40%;"  @click="gotourl()">
                     发布
            </el-button>
            <el-button v-if="ruleForm.mobile_phone" type="plain"  style="width: 40%;"  @click="switchPriview(true)">
                关闭
            </el-button>
        </div>
    </div>



</div>
<script src="/vue2.6.11.js"></script>
<script src="/element-ui.js"></script>
<script src="/jquery-1.9.1.min.js"></script>
<style>
    html {
        font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    }

    .el-container {
        margin-left: 2px;
        justify-content: flex-start;
    }

    h3 {
        font-family: cursive;
        padding-left: 4rem;

    }

    .el-form-item__label {
        font-weight: bolder;
        width: 120px !important;
    }

    .demo-ruleForm {
        display: flex;
        border-left: 1px solid #a6a9ad;
        flex-direction: column;
        align-content: flex-start;
        padding-bottom: 20px;
    }

</style>
<script>
    new Vue({
        el: '#app',
        delimiters: ['<{', '}>'],  //分隔符
        data: function () {
            return {
                dialogVisible: false,
                dialogImageUrl: '',
                disabled: false,
                fileList: [],
                btn_disabled: false,
                userInfo:[],
                uuid:'',
                editVisible:true,
                priviewVisible:false,
                ruleForm: {
                    webtitle: '',
                    realname: '',
                    mobile_phone: '',
                    weixing: '',
                    xiaohongshu: '',
                    desc: '',
                },
                rules: {
                    realname: [
                        {required: true, message: '请输入姓名', trigger: 'blur'},
                        {min: 1, max: 20, message: '长度在1 到20 个字', trigger: 'blur'}
                    ],
                    mobile_phone: [
                        {required: true, message: '手机号必输', trigger: 'change'},
                        {
                            pattern: /^1[3-9]\d{9}$/, // 这是一个匹配11位手机号的正则表达式
                            message: '请输入正确的11位手机号',
                            trigger: 'change'
                        }
                    ],
                    desc: [
                        {required: true, message: '请填写备注', trigger: 'blur'}
                    ]
                }
            }
        },
        methods: {
            submitForm(formName) {
                if (!this.ruleForm.mobile_phone) {
                    return this.$notify.info({
                        title: '提示',
                        message: '请输入内容'
                    });

                }
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        if (this.fileList.length == 0) {
                            this.$notify.info({
                                title: '提示',
                                message: '请上传最少一张图'
                            });
                            return false;
                        }
                        this.ruleForm.fileList = this.fileList
                        this.btn_disabled = true;
                        let _self = this;
                        setTimeout(function () {
                            _self.btn_disabled = false;
                        }, 3000)
                        this.$notify.info({
                            title: '消息',
                            message: '正在提交中...'
                        });
                        $.ajax({
                            type: "POST",
                            url: "/user/reguser",
                            contentType: "application/json",
                            data: JSON.stringify(this.ruleForm),
                            success: function (data) {
                                if (data.code == 0 && data.data?.uuid) {
                                    // console.log(data);
                                    // window.location.href = "/userinfo/" + data.data.uuid;
                                    // return false;
                                    _self.uuid = data.data.uuid;
                                    _self.getuserbymobile();

                                    return false;
                                }

                            }
                        });
                    } else {
                        console.log('error submit!!');
                        this.$notify({
                            title: '警告',
                            message: '提交失败！',
                            type: 'warning'
                        });
                        return false;
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            },
            handleChange(file, fileList) {

            },
            handleRemove(file) {
                if (this.fileList.length == 0) return;
                this.fileList = this.fileList.filter((item) => item.uid !== file.uid);
            },
            handlePictureCardPreview(file, fileList) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            },
            handSuccess(file, fileList) {
                this.fileList.push(fileList);
            },
            getuserbymobile() {
                let _self = this;
                let postData ={}
                postData.mobile_phone = _self.ruleForm.mobile_phone
                $.ajax({
                    type: "POST",
                    url: "/user/getuserbymobile",
                    contentType: "application/json",
                    data:JSON.stringify(postData),
                    success: function (data) {
                        _self.userInfo = data.data.userinfo;
                        _self.userInfo.images = _self.userInfo.images.split(";")
                        if (data.data.userinfo.webtitle) {
                            _self.userInfo.website = data.data.userinfo.webtitle
                        } else {
                            _self.userInfo.website = data.data.userinfo.realname
                        }
                        _self.editVisible = false;
                        _self.priviewVisible = ! this.editVisible
                    }
                });
            },
            gotourl() {
                window.location.href = "/userinfo/" + this.uuid;
                return false;
            },
            switchPriview(_bool) {
                 this.editVisible = _bool;
                 this.priviewVisible = ! this.editVisible
            }
        },

        mounted() {
            // this.getuserbymobile();
        }
    })
</script>
</body>
</html>